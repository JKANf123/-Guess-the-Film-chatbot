import sqlite3
import random
import requests
from aiogram import Bot, Dispatcher, types
from aiogram.utils import executor

TOKEN = "YOUR_TELEGRAM_BOT_TOKEN"
bot = Bot(token=TOKEN)
dp = Dispatcher(bot)

# –§—É–Ω–∫—Ü–∏—è –≤—ã–±–æ—Ä–∞ —Å–ª—É—á–∞–π–Ω–æ–≥–æ —Ñ–∏–ª—å–º–∞
def get_random_movie():
    conn = sqlite3.connect('movies.db')
    cursor = conn.cursor()
    cursor.execute("SELECT title, description FROM movies ORDER BY RANDOM() LIMIT 1")
    movie = cursor.fetchone()
    conn.close()
    return movie

# –§—É–Ω–∫—Ü–∏—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø–æ–¥—Å–∫–∞–∑–∫–∏ (1-—è –±—É–∫–≤–∞ + –¥–ª–∏–Ω–∞ —Å–ª–æ–≤–∞)
def get_hint(movie_title):
    return movie_title[0] + "*" * (len(movie_title) - 1)

# –°—Ç–∞—Ä—Ç –±–æ—Ç–∞
@dp.message_handler(commands=['start'])
async def start_game(message: types.Message):
    movie = get_random_movie()
    title, description = movie
    await message.answer(f"üé¨ –£–≥–∞–¥–∞–π —Ñ–∏–ª—å–º:\n\n{description}")
    dp.current_movie = title.lower()

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—Ç–≤–µ—Ç–∞
@dp.message_handler()
async def check_answer(message: types.Message):
    user_answer = message.text.lower()
    
    if user_answer == dp.current_movie:
        await message.reply("‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ! üéâ")
        new_movie = get_random_movie()
        title, description = new_movie
        dp.current_movie = title.lower()
        await message.answer(f"üé¨ –°–ª–µ–¥—É—é—â–∏–π —Ñ–∏–ª—å–º:\n\n{description}")
    else:
        hint = get_hint(dp.current_movie)
        await message.reply(f"‚ùå –ù–µ–≤–µ—Ä–Ω–æ! –ü–æ–¥—Å–∫–∞–∑–∫–∞: {hint}")

if __name__ == '__main__':
    executor.start_polling(dp)
